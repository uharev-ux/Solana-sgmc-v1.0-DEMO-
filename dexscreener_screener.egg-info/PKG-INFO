Metadata-Version: 2.4
Name: dexscreener-screener
Version: 1.0.0
Summary: DexScreener Screener v1: collect and normalize Solana pair data from public API
Requires-Python: >=3.10
Description-Content-Type: text/markdown
Requires-Dist: httpx>=0.27.0

# Solana-sgmc-v1.0-DEMO-
Страшное позади, самое страшное впереди)

---

## DexScreener Screener v1 — Quickstart

CLI для сбора и нормализации данных по парам Solana из публичного API DexScreener. Никакой торговли, только чтение API и сохранение в SQLite. Используется только публичный DexScreener API по сети; ключи и секреты не требуются.

### Требования

- Python 3.10+

### Установка

1. Создать виртуальное окружение и активировать его:

   **Windows (PowerShell):**
   ```powershell
   python -m venv .venv
   .venv\Scripts\Activate.ps1
   ```

   **Linux / macOS:**
   ```bash
   python -m venv .venv
   source .venv/bin/activate
   ```

2. Установить зависимости:

   ```bash
   pip install -r requirements.txt
   ```

   Или установить пакет в режиме разработки:

   ```bash
   pip install -e .
   ```

### Примеры команд

**Сбор по списку токенов (mint-адреса):**

Файл `tokens.csv` — одна колонка с адресами токенов (или одна строка с адресами через запятую):

```bash
python -m dexscreener_screener.cli collect --tokens tokens.csv --db dexscreener.sqlite
```

**Сбор по списку пар (pair addresses):**

Файл `pairs.csv` — одна колонка с адресами пар:

```bash
python -m dexscreener_screener.cli collect --pairs pairs.csv --db dexscreener.sqlite
```

**Выгрузка данных из SQLite:**

JSON:

```bash
python -m dexscreener_screener.cli export --table snapshots --format json --out snapshots.json --db dexscreener.sqlite
```

CSV:

```bash
python -m dexscreener_screener.cli export --table snapshots --format csv --out snapshots.csv --db dexscreener.sqlite
```

Можно выгружать таблицы `snapshots`, `pairs` или `tokens`:

```bash
python -m dexscreener_screener.cli export --table pairs --format json --out pairs.json --db dexscreener.sqlite
```

### Prune (очистка устаревших данных)

База автоматически хранит **только пары моложе 24 часов** (по `pair_created_at_ms`). Пары старше 24h удаляются автоматически при каждом успешном `collect` и каждом цикле `collect-new`. Пары с `pair_created_at_ms IS NULL` или `0` не удаляются по возрасту.

**Ручной запуск prune:**
```bash
python -m dexscreener_screener.cli prune --db dexscreener.sqlite --max-age-hours 24
```

**Dry-run** — показать, что будет удалено, без изменений в базе:
```bash
python -m dexscreener_screener.cli prune --db dexscreener.sqlite --max-age-hours 24 --dry-run
```

**VACUUM** — после удаления освободить место на диске (рекомендуется периодически):
```bash
python -m dexscreener_screener.cli prune --db dexscreener.sqlite --max-age-hours 24 --vacuum
```

**Отключить auto-prune** в collect/collect-new:
```bash
python -m dexscreener_screener.cli collect --pairs pairs.csv --no-prune
python -m dexscreener_screener.cli collect-new --no-prune
```

### Self-check (проверка инвариантов БД)

Проверка, что в БД только пары моложе 24h (инварианты prune_by_pair_age). Exit code: 0 = OK, 2 = FAIL.

```bash
python -m dexscreener_screener.cli self-check --db dexscreener.sqlite
```

С автоматическим исправлением при нарушении (запуск prune и повторная проверка):

```bash
python -m dexscreener_screener.cli self-check --db dexscreener.sqlite --fix
```

### Strategy (второй скринер: ATH и просадка)

Стратегический слой на основе **реальных цен** из БД (без %change). ATH = max(price) за жизнь пары (age ≤ 24h), просадка: `drop_from_ath = (ath_price - current_price) / ath_price * 100`. Hard-фильтры: age ≤ 24h, liquidity ≥ MIN_LIQ, volume ≥ MIN_VOL, txns ≥ MIN_TXNS, ath ≠ current. WATCHLIST: просадка 30–50%; SIGNAL: просадка 50–60%, рынок жив (txns, buys, liq), cooldown.

**Один запуск:**
```bash
python -m dexscreener_screener.cli strategy --once --db dexscreener.sqlite
```

**Цикл каждые 60 секунд (остановка: Ctrl+C):**
```bash
python -m dexscreener_screener.cli strategy --loop 60 --db dexscreener.sqlite
```

Вывод: WATCHLIST (pair, drop%, liq, vol, txns) и SIGNAL (pair, drop%, ath_price, current_price, ссылка DexScreener).

При выдаче SIGNAL автоматически создаются `signal_events` и `signal_evaluations` (PENDING) для пост-анализа.

### Post-analysis (оценка качества сигналов)

Автоматическая оценка качества SIGNAL через 30/60/120 минут по данным snapshots.

**Один запуск:**
```bash
python -m dexscreener_screener.cli post --once --db dexscreener.sqlite
```

**Цикл каждые 60 секунд (остановка: Ctrl+C):**
```bash
python -m dexscreener_screener.cli post --loop 60 --db dexscreener.sqlite
```

### Autopilot (compileall + smoke_test + strategy_selfcheck)

```bash
python scripts/autopilot.py --db dexscreener.sqlite
```
